{% extends 'base_modern.html' %}
{% load static %}

{% block title %}{% if object %}Edit RFQ{% else %}Create RFQ{% endif %}{% endblock %}

{% block extra_css %}
<!-- Flatpickr CSS for better date picker -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
<style>
    .flatpickr-calendar {
        font-family: system-ui, -apple-system, sans-serif;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        border: 1px solid #e5e7eb;
    }
    .flatpickr-day.selected {
        background: #1e3a8a;
        border-color: #1e3a8a;
    }
    .flatpickr-day.today {
        border-color: #3b82f6;
    }
    .form-input {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        transition: all 0.15s ease;
    }
    .form-input:focus {
        outline: none;
        border-color: #1e3a8a;
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
    }
    .form-textarea {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        resize: vertical;
        min-height: 100px;
    }
    .form-textarea:focus {
        outline: none;
        border-color: #1e3a8a;
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
    }
    .form-select {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        background-color: white;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
        appearance: none;
    }
    .form-select:focus {
        outline: none;
        border-color: #1e3a8a;
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
    }
    .form-checkbox {
        width: 1rem;
        height: 1rem;
        color: #1e3a8a;
        border: 1px solid #d1d5db;
        border-radius: 0.25rem;
    }
    .form-checkbox:focus {
        ring-color: #1e3a8a;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header Section -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'procurement:rfq_list' %}"
                       class="inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i> Back to RFQs
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">
                            {% if object %}
                                Edit RFQ: {{ object.rfq_number }}
                            {% else %}
                                Create New Request for Quote
                            {% endif %}
                        </h1>
                        <p class="mt-1 text-sm text-gray-600">
                            {% if object %}
                                Modify the details of your RFQ below
                            {% else %}
                                Fill out the form below to request quotes from suppliers
                            {% endif %}
                        </p>
                    </div>
                </div>
                {% if object %}
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 rounded-full text-sm font-medium
                        {% if object.status == 'draft' %}bg-gray-100 text-gray-800
                        {% elif object.status == 'published' %}bg-blue-100 text-blue-800
                        {% elif object.status == 'closed' %}bg-red-100 text-red-800
                        {% else %}bg-green-100 text-green-800{% endif %}">
                        {{ object.get_status_display }}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Progress Indicator for New RFQ -->
    {% if not object %}
    <div class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-navy-600 text-white text-sm font-bold">1</div>
                        <span class="ml-2 text-sm font-medium text-gray-900">Basic Info</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-300 text-white text-sm font-bold">2</div>
                        <span class="ml-2 text-sm text-gray-500">Items</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-300 text-white text-sm font-bold">3</div>
                        <span class="ml-2 text-sm text-gray-500">Suppliers</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-300 text-white text-sm font-bold">4</div>
                        <span class="ml-2 text-sm text-gray-500">Review</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Main Form Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <form method="post" id="rfq-form">
            {% csrf_token %}

            <!-- Form Errors -->
            {% if form.non_field_errors %}
            <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-6">
                <div class="flex">
                    <i class="fas fa-exclamation-circle text-red-400"></i>
                    <div class="ml-3">
                        <p class="text-sm text-red-700">{{ form.non_field_errors }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Column (2/3 width) -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Basic Information Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-info-circle mr-2 text-navy-600"></i>
                                Basic Information
                            </h2>
                        </div>
                        <div class="p-6 space-y-6">
                            {% if form.title %}
                            <div>
                                <label for="id_title" class="block text-sm font-medium text-gray-700 mb-2">
                                    RFQ Title <span class="text-red-500">*</span>
                                </label>
                                {{ form.title }}
                                {% if form.title.errors %}
                                <p class="mt-1 text-sm text-red-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.title.errors.0 }}
                                </p>
                                {% endif %}
                                <p class="mt-1 text-xs text-gray-500">Provide a clear, descriptive title for your RFQ</p>
                            </div>
                            {% endif %}

                            {% if form.description %}
                            <div>
                                <label for="id_description" class="block text-sm font-medium text-gray-700 mb-2">
                                    Detailed Description <span class="text-red-500">*</span>
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                <p class="mt-1 text-sm text-red-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.description.errors.0 }}
                                </p>
                                {% endif %}
                                <p class="mt-1 text-xs text-gray-500">Include all relevant details, specifications, and requirements</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Organization Details Card -->
                    {% if form.department or form.cost_center %}
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-building mr-2 text-navy-600"></i>
                                Organization Details
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {% if form.department %}
                                <div>
                                    <label for="id_department" class="block text-sm font-medium text-gray-700 mb-2">
                                        Department
                                    </label>
                                    {{ form.department }}
                                    {% if form.department.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.department.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Requesting department</p>
                                </div>
                                {% endif %}

                                {% if form.cost_center %}
                                <div>
                                    <label for="id_cost_center" class="block text-sm font-medium text-gray-700 mb-2">
                                        Cost Center
                                    </label>
                                    {{ form.cost_center }}
                                    {% if form.cost_center.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.cost_center.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Budget allocation code</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Timeline & Delivery Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-calendar-alt mr-2 text-navy-600"></i>
                                Timeline & Delivery
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {% if form.deadline %}
                                <div>
                                    <label for="id_deadline" class="block text-sm font-medium text-gray-700 mb-2">
                                        Response Deadline <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.deadline }}
                                    {% if form.deadline.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.deadline.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">When do you need quotes by?</p>
                                </div>
                                {% endif %}

                                {% if form.required_delivery_date %}
                                <div>
                                    <label for="id_required_delivery_date" class="block text-sm font-medium text-gray-700 mb-2">
                                        Expected Delivery Date
                                    </label>
                                    {{ form.required_delivery_date }}
                                    {% if form.required_delivery_date.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.required_delivery_date.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">When do you need the items delivered?</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Commercial Terms Card -->
                    {% if form.payment_terms or form.delivery_terms or form.terms_and_conditions %}
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-file-contract mr-2 text-navy-600"></i>
                                Commercial Terms
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                {% if form.payment_terms %}
                                <div>
                                    <label for="id_payment_terms" class="block text-sm font-medium text-gray-700 mb-2">
                                        Payment Terms
                                    </label>
                                    {{ form.payment_terms }}
                                    {% if form.payment_terms.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.payment_terms.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">e.g., Net 30, 2/10 Net 30</p>
                                </div>
                                {% endif %}

                                {% if form.delivery_terms %}
                                <div>
                                    <label for="id_delivery_terms" class="block text-sm font-medium text-gray-700 mb-2">
                                        Delivery Terms
                                    </label>
                                    {{ form.delivery_terms }}
                                    {% if form.delivery_terms.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.delivery_terms.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">e.g., FOB, CIF, DDP</p>
                                </div>
                                {% endif %}
                            </div>

                            {% if form.terms_and_conditions %}
                            <div>
                                <label for="id_terms_and_conditions" class="block text-sm font-medium text-gray-700 mb-2">
                                    Additional Terms & Conditions
                                </label>
                                {{ form.terms_and_conditions }}
                                {% if form.terms_and_conditions.errors %}
                                <p class="mt-1 text-sm text-red-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.terms_and_conditions.errors.0 }}
                                </p>
                                {% endif %}
                                <p class="mt-1 text-xs text-gray-500">Any special terms, conditions, or requirements</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Evaluation & Priority Card -->
                    {% if form.priority or form.public_rfq or form.evaluation_criteria %}
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-tasks mr-2 text-navy-600"></i>
                                Evaluation & Priority
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                {% if form.priority %}
                                <div>
                                    <label for="id_priority" class="block text-sm font-medium text-gray-700 mb-2">
                                        Priority Level
                                    </label>
                                    {{ form.priority }}
                                    {% if form.priority.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.priority.errors.0 }}
                                    </p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Set the urgency of this RFQ</p>
                                </div>
                                {% endif %}

                                {% if form.public_rfq %}
                                <div>
                                    <label for="id_public_rfq" class="block text-sm font-medium text-gray-700 mb-2">
                                        RFQ Visibility
                                    </label>
                                    <div class="flex items-center mt-3">
                                        {{ form.public_rfq }}
                                        <label for="id_public_rfq" class="ml-2 text-sm text-gray-700">
                                            Make this RFQ public (visible to all suppliers)
                                        </label>
                                    </div>
                                    {% if form.public_rfq.errors %}
                                    <p class="mt-1 text-sm text-red-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {{ form.public_rfq.errors.0 }}
                                    </p>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>

                            {% if form.evaluation_criteria %}
                            <div>
                                <label for="id_evaluation_criteria" class="block text-sm font-medium text-gray-700 mb-2">
                                    Evaluation Criteria
                                </label>
                                {{ form.evaluation_criteria }}
                                {% if form.evaluation_criteria.errors %}
                                <p class="mt-1 text-sm text-red-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.evaluation_criteria.errors.0 }}
                                </p>
                                {% endif %}
                                <p class="mt-1 text-xs text-gray-500">Define how quotes will be evaluated (e.g., price weight: 40%, quality: 30%, delivery: 30%)</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Sidebar (1/3 width) -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Quick Info Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900">Quick Info</h2>
                        </div>
                        <div class="p-6 space-y-4">
                            {% if object %}
                            <div>
                                <p class="text-sm text-gray-600">RFQ Number</p>
                                <p class="font-semibold">{{ object.rfq_number }}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Created By</p>
                                <p class="font-semibold">{{ object.created_by.get_full_name|default:object.created_by.username }}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Created On</p>
                                <p class="font-semibold">{{ object.created_at|date:"M d, Y" }}</p>
                            </div>
                            {% else %}
                            {% if form.rfq_number %}
                            <div>
                                <label for="id_rfq_number" class="block text-sm font-medium text-gray-700 mb-2">
                                    RFQ Number
                                </label>
                                {{ form.rfq_number }}
                                {% if form.rfq_number.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.rfq_number.errors.0 }}</p>
                                {% endif %}
                            </div>
                            {% endif %}
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex">
                                    <i class="fas fa-info-circle text-blue-600 mt-0.5"></i>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-blue-900">Creating New RFQ</h3>
                                        <p class="mt-1 text-xs text-blue-700">
                                            After creating this RFQ, you'll be able to add items and select suppliers.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            {% if form.status %}
                            <div>
                                <label for="id_status" class="block text-sm font-medium text-gray-700 mb-2">
                                    Status
                                </label>
                                {{ form.status }}
                                {% if form.status.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.status.errors.0 }}</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Help Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h2 class="text-lg font-semibold text-gray-900">Need Help?</h2>
                        </div>
                        <div class="p-6 space-y-3">
                            <a href="#" class="flex items-center text-sm text-navy-600 hover:text-navy-800">
                                <i class="fas fa-book mr-2"></i> RFQ Guidelines
                            </a>
                            <a href="#" class="flex items-center text-sm text-navy-600 hover:text-navy-800">
                                <i class="fas fa-file-alt mr-2"></i> Sample RFQ Template
                            </a>
                            <a href="#" class="flex items-center text-sm text-navy-600 hover:text-navy-800">
                                <i class="fas fa-question-circle mr-2"></i> FAQs
                            </a>
                            <a href="#" class="flex items-center text-sm text-navy-600 hover:text-navy-800">
                                <i class="fas fa-headset mr-2"></i> Contact Support
                            </a>
                        </div>
                    </div>

                    <!-- Tips Card -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex">
                            <i class="fas fa-lightbulb text-yellow-600 mt-0.5"></i>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-yellow-900">Pro Tips</h3>
                                <ul class="mt-2 text-xs text-yellow-700 space-y-1">
                                    <li>• Be specific about your requirements</li>
                                    <li>• Set realistic deadlines</li>
                                    <li>• Include all relevant specifications</li>
                                    <li>• Clear payment terms get better responses</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Form Actions (Outside form to prevent layout issues) -->
        <div class="mt-8 mb-8">
            <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div class="flex items-center space-x-3">
                        <button type="button" onclick="saveDraft()"
                                class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                            <i class="fas fa-save mr-2"></i> Save as Draft
                        </button>
                        <button type="button" onclick="previewRFQ()"
                                class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                            <i class="fas fa-eye mr-2"></i> Preview
                        </button>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a href="{% url 'procurement:rfq_list' %}"
                           class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                            Cancel
                        </a>
                        <button type="button" onclick="submitForm()"
                                class="px-6 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-navy-600 hover:bg-navy-700 transition-colors">
                            {% if object %}
                                <i class="fas fa-check mr-2"></i> Update RFQ
                            {% else %}
                                <i class="fas fa-arrow-right mr-2"></i> Continue to Items
                            {% endif %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Apply basic styles to form elements if not already styled
    const inputs = document.querySelectorAll('input[type="text"]:not(.styled), input[type="email"]:not(.styled), input[type="number"]:not(.styled)');
    inputs.forEach(input => {
        if (!input.classList.contains('form-input')) {
            input.classList.add('form-input');
        }
        input.classList.add('styled');
    });

    const textareas = document.querySelectorAll('textarea:not(.styled)');
    textareas.forEach(textarea => {
        if (!textarea.classList.contains('form-textarea')) {
            textarea.classList.add('form-textarea');
        }
        textarea.classList.add('styled');
    });

    const selects = document.querySelectorAll('select:not(.styled)');
    selects.forEach(select => {
        if (!select.classList.contains('form-select')) {
            select.classList.add('form-select');
        }
        select.classList.add('styled');
    });

    // Initialize date pickers with Flatpickr
    const dateFields = document.querySelectorAll('input[type="date"], input[type="datetime-local"]');
    dateFields.forEach(field => {
        flatpickr(field, {
            enableTime: field.type === 'datetime-local',
            dateFormat: field.type === 'datetime-local' ? "Y-m-d H:i" : "Y-m-d",
            altInput: true,
            altFormat: field.type === 'datetime-local' ? "F j, Y at h:i K" : "F j, Y",
            minDate: "today"
        });
    });
});

// Function to save as draft
function saveDraft() {
    const form = document.getElementById('rfq-form');
    if (form) {
        // Find or create status field
        let statusField = document.getElementById('id_status');
        if (!statusField) {
            statusField = document.createElement('input');
            statusField.type = 'hidden';
            statusField.name = 'status';
            statusField.id = 'id_status';
            form.appendChild(statusField);
        }
        statusField.value = 'draft';

        // Add save_as_draft flag
        const draftInput = document.createElement('input');
        draftInput.type = 'hidden';
        draftInput.name = 'save_as_draft';
        draftInput.value = 'true';
        form.appendChild(draftInput);

        form.submit();
    }
}

// Function to submit the form
function submitForm() {
    const form = document.getElementById('rfq-form');
    if (form) {
        // Basic validation
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!field.value || field.value.trim() === '') {
                isValid = false;
                field.classList.add('border-red-500');
            } else {
                field.classList.remove('border-red-500');
            }
        });

        if (isValid) {
            form.submit();
        } else {
            alert('Please fill in all required fields.');
        }
    }
}

// Function to preview RFQ
function previewRFQ() {
    const form = document.getElementById('rfq-form');
    if (form) {
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });
        sessionStorage.setItem('rfq_preview_data', JSON.stringify(data));
        alert('Preview functionality will be available soon.');
    }
}
</script>
{% endblock %}