{% extends 'base_modern.html' %}
{% load static %}

{% block title %}{{ supplier.name }} - Supplier Details{% endblock %}

{% block content %}
<div class="p-6">
    <!-- Header -->
    <div class="mb-6 flex justify-between items-start">
        <div>
            <div class="flex items-center space-x-3 mb-2">
                <a href="{% url 'procurement:supplier_list' %}" class="text-navy-600 hover:text-navy-800">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h1 class="text-3xl font-bold text-gray-900">{{ supplier.name }}</h1>
            </div>
            <div class="flex items-center space-x-4 text-sm text-gray-600">
                <span><i class="fas fa-hashtag mr-1"></i>{{ supplier.code }}</span>
                <span class="px-2 py-1 rounded-full 
                    {% if supplier.status == 'active' %}bg-green-100 text-green-800
                    {% elif supplier.status == 'inactive' %}bg-gray-100 text-gray-800
                    {% elif supplier.status == 'pending_approval' %}bg-yellow-100 text-yellow-800
                    {% else %}bg-red-100 text-red-800{% endif %}">
                    {{ supplier.get_status_display }}
                </span>
                <span class="px-2 py-1 rounded-full 
                    {% if supplier.risk_level == 'low' %}bg-green-100 text-green-800
                    {% elif supplier.risk_level == 'medium' %}bg-yellow-100 text-yellow-800
                    {% elif supplier.risk_level == 'high' %}bg-orange-100 text-orange-800
                    {% else %}bg-red-100 text-red-800{% endif %}">
                    <i class="fas fa-exclamation-triangle mr-1"></i>{{ supplier.get_risk_level_display }}
                </span>
            </div>
        </div>
        <div class="flex space-x-3">
            <button onclick="window.location.href='{% url 'procurement:supplier_update' supplier.id %}'"
                    class="btn btn-secondary">
                <i class="fas fa-edit mr-2"></i> Edit Supplier
            </button>
            <button onclick="createRFQ('{{ supplier.id }}')" class="btn btn-primary">
                <i class="fas fa-file-invoice mr-2"></i> Create RFQ
            </button>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column - Supplier Details -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Basic Information -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Basic Information</h2>
                <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <dt class="text-sm text-gray-600">Supplier Type</dt>
                        <dd class="font-medium">{{ supplier.get_supplier_type_display }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Country</dt>
                        <dd class="font-medium">{{ supplier.country|default:"-" }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Region</dt>
                        <dd class="font-medium">{{ supplier.region|default:"-" }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Website</dt>
                        <dd class="font-medium">
                            {% if supplier.website %}
                            <a href="{{ supplier.website }}" target="_blank" class="text-navy-600 hover:text-navy-800">
                                {{ supplier.website }} <i class="fas fa-external-link-alt text-xs"></i>
                            </a>
                            {% else %}
                            -
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>

            <!-- Contact Information -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Primary Contact</h2>
                <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <dt class="text-sm text-gray-600">Contact Name</dt>
                        <dd class="font-medium">{{ supplier.primary_contact_name|default:"-" }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Email</dt>
                        <dd class="font-medium">
                            {% if supplier.primary_contact_email %}
                            <a href="mailto:{{ supplier.primary_contact_email }}" class="text-navy-600 hover:text-navy-800">
                                {{ supplier.primary_contact_email }}
                            </a>
                            {% else %}
                            -
                            {% endif %}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Phone</dt>
                        <dd class="font-medium">{{ supplier.primary_contact_phone|default:"-" }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Address</dt>
                        <dd class="font-medium">
                            {% if supplier.address %}
                                {{ supplier.address.street|default:"" }}<br>
                                {{ supplier.address.city|default:"" }}, {{ supplier.address.state|default:"" }} {{ supplier.address.zip|default:"" }}
                            {% else %}
                            -
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>

            <!-- Performance Metrics -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Performance Metrics</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm text-gray-600 mb-2">Overall Rating</p>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">{{ supplier.rating|floatformat:1 }}</span>
                            <div class="flex text-yellow-400">
                                {% if supplier.rating >= 1 %}<i class="fas fa-star"></i>{% else %}<i class="far fa-star"></i>{% endif %}
                                {% if supplier.rating >= 2 %}<i class="fas fa-star"></i>{% else %}<i class="far fa-star"></i>{% endif %}
                                {% if supplier.rating >= 3 %}<i class="fas fa-star"></i>{% else %}<i class="far fa-star"></i>{% endif %}
                                {% if supplier.rating >= 4 %}<i class="fas fa-star"></i>{% else %}<i class="far fa-star"></i>{% endif %}
                                {% if supplier.rating >= 5 %}<i class="fas fa-star"></i>{% elif supplier.rating >= 4.5 %}<i class="fas fa-star-half-alt"></i>{% else %}<i class="far fa-star"></i>{% endif %}
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">On-Time Delivery</p>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">{{ supplier.on_time_delivery_rate|floatformat:0 }}%</span>
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-green-600 h-2 rounded-full" style="width: {{ supplier.on_time_delivery_rate }}%"></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">Quality Score</p>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">{{ supplier.quality_score|floatformat:0 }}%</span>
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: {{ supplier.quality_score }}%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-200 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <p class="text-sm text-gray-600">Total Quotes</p>
                        <p class="text-lg font-bold">{{ performance_metrics.total_quotes }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Approved Quotes</p>
                        <p class="text-lg font-bold text-green-600">{{ performance_metrics.approved_quotes }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Response Time</p>
                        <p class="text-lg font-bold">{{ performance_metrics.avg_response_time }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Acceptance Rate</p>
                        <p class="text-lg font-bold">{{ performance_metrics.quote_acceptance_rate }}%</p>
                    </div>
                </div>
            </div>

            <!-- Recent RFQs -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold">Recent RFQs</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>RFQ Number</th>
                                <th>Title</th>
                                <th>Status</th>
                                <th>Deadline</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rfq in recent_rfqs %}
                            <tr>
                                <td class="font-medium">{{ rfq.rfq_number }}</td>
                                <td>{{ rfq.title }}</td>
                                <td>
                                    <span class="status-badge status-{{ rfq.status }}">
                                        {{ rfq.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ rfq.deadline|date:"M d, Y" }}</td>
                                <td>
                                    <a href="{% url 'procurement:rfq_detail' rfq.id %}" 
                                       class="text-navy-600 hover:text-navy-800">
                                        View <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-4 text-gray-500">
                                    No RFQs sent to this supplier yet
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Right Column - Sidebar -->
        <div class="space-y-6">
            <!-- Financial Information -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Financial Information</h2>
                <dl class="space-y-3">
                    <div>
                        <dt class="text-sm text-gray-600">Payment Terms</dt>
                        <dd class="font-medium">{{ supplier.payment_terms|default:"-" }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Currency</dt>
                        <dd class="font-medium">{{ supplier.currency }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Credit Limit</dt>
                        <dd class="font-medium">
                            {% if supplier.credit_limit %}
                            ${{ supplier.credit_limit|floatformat:2 }}
                            {% else %}
                            Not Set
                            {% endif %}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-600">Tax ID</dt>
                        <dd class="font-medium">{{ supplier.tax_id|default:"-" }}</dd>
                    </div>
                </dl>
            </div>

            <!-- Compliance & Certifications -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Compliance</h2>
                {% if supplier.certifications %}
                <div class="space-y-2">
                    {% for cert in supplier.certifications %}
                    <div class="flex items-center">
                        <i class="fas fa-certificate text-green-500 mr-2"></i>
                        <span class="text-sm">{{ cert }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-gray-500">No certifications listed</p>
                {% endif %}
            </div>

            <!-- Actions -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Actions</h2>
                <div class="space-y-2">
                    <button onclick="sendMessage('{{ supplier.id }}')" class="btn btn-outline w-full">
                        <i class="fas fa-envelope mr-2"></i> Send Message
                    </button>
                    <button onclick="viewDocuments('{{ supplier.id }}')" class="btn btn-outline w-full">
                        <i class="fas fa-folder-open mr-2"></i> View Documents
                    </button>
                    <button onclick="exportSupplier('{{ supplier.id }}')" class="btn btn-outline w-full">
                        <i class="fas fa-download mr-2"></i> Export Details
                    </button>
                    {% if is_admin %}
                    <button onclick="deleteSupplier('{{ supplier.id }}')" class="btn btn-outline-danger w-full">
                        <i class="fas fa-trash mr-2"></i> Delete Supplier
                    </button>
                    {% endif %}
                </div>
            </div>

            <!-- Notes -->
            {% if supplier.notes %}
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Notes</h2>
                <p class="text-sm text-gray-700">{{ supplier.notes }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script>
function createRFQ(supplierId) {
    window.location.href = `/procurement/rfqs/create/?supplier=${supplierId}`;
}

function sendMessage(supplierId) {
    // Implementation for sending message
    console.log('Send message to supplier:', supplierId);
}

function viewDocuments(supplierId) {
    // Implementation for viewing documents
    console.log('View documents for supplier:', supplierId);
}

function exportSupplier(supplierId) {
    window.location.href = `/procurement/suppliers/${supplierId}/export/`;
}

function deleteSupplier(supplierId) {
    if (confirm('Are you sure you want to delete this supplier? This action cannot be undone.')) {
        // Implementation for deleting supplier
        console.log('Delete supplier:', supplierId);
    }
}
</script>
{% endblock %}