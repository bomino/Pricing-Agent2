<!-- Predictions Tab Content -->

<!-- Prediction Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="p-4 bg-white border border-gray-200 rounded-lg hover:shadow-lg transition-shadow">
        <div class="text-center">
            <i class="fas fa-chart-line text-4xl text-purple-600 mb-3"></i>
            <h4 class="font-semibold text-lg mb-2">Price Forecast</h4>
            <p class="text-3xl font-bold {% if prediction_metrics.avg_price_change >= 0 %}text-red-600{% else %}text-green-600{% endif %} mb-2">
                {% if prediction_metrics.avg_price_change >= 0 %}+{% endif %}{{ prediction_metrics.avg_price_change|floatformat:1|default:"0" }}%
            </p>
            <p class="text-sm text-gray-600">Avg predicted change</p>
            <div class="mt-4">
                <button class="text-sm text-purple-600 hover:text-purple-700 font-medium"
                        hx-get="/analytics/predictions/price-details/"
                        hx-target="#modal-container">
                    View Details →
                </button>
            </div>
        </div>
    </div>

    <div class="p-4 bg-white border border-gray-200 rounded-lg hover:shadow-lg transition-shadow">
        <div class="text-center">
            <i class="fas fa-box text-4xl text-indigo-600 mb-3"></i>
            <h4 class="font-semibold text-lg mb-2">Demand Forecast</h4>
            <p class="text-3xl font-bold text-indigo-600 mb-2">{{ prediction_metrics.demand_forecast|default:"0" }}</p>
            <p class="text-sm text-gray-600">Orders next month</p>
            <div class="mt-4">
                <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium"
                        hx-get="/analytics/predictions/demand-details/"
                        hx-target="#modal-container">
                    View Forecast →
                </button>
            </div>
        </div>
    </div>

    <div class="p-4 bg-white border border-gray-200 rounded-lg hover:shadow-lg transition-shadow">
        <div class="text-center">
            <i class="fas fa-percentage text-4xl text-green-600 mb-3"></i>
            <h4 class="font-semibold text-lg mb-2">Model Accuracy</h4>
            <p class="text-3xl font-bold text-green-600 mb-2">{{ prediction_metrics.model_accuracy|floatformat:1|default:"0" }}%</p>
            <p class="text-sm text-gray-600">Last 30 days</p>
            <div class="mt-4">
                <button class="text-sm text-green-600 hover:text-green-700 font-medium"
                        hx-get="/analytics/predictions/accuracy/"
                        hx-target="#modal-container">
                    View Metrics →
                </button>
            </div>
        </div>
    </div>

    <div class="p-4 bg-white border border-gray-200 rounded-lg hover:shadow-lg transition-shadow">
        <div class="text-center">
            <i class="fas fa-exclamation-triangle text-4xl text-orange-600 mb-3"></i>
            <h4 class="font-semibold text-lg mb-2">Risk Alerts</h4>
            <p class="text-3xl font-bold text-orange-600 mb-2">{{ prediction_metrics.risk_alerts|default:"0" }}</p>
            <p class="text-sm text-gray-600">High priority</p>
            <div class="mt-4">
                <button class="text-sm text-orange-600 hover:text-orange-700 font-medium"
                        hx-get="/analytics/predictions/risks/"
                        hx-target="#modal-container">
                    View Alerts →
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Price Predictions Section -->
<div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-navy-900">
            <i class="fas fa-chart-line text-purple-600 mr-2"></i>
            Material Price Predictions (Next 30 Days)
        </h3>
        <select class="form-select text-sm"
                hx-get="/analytics/predictions/filter/"
                hx-target="#predictions-list"
                hx-trigger="change">
            <option value="all">All Materials</option>
            <option value="volatile">High Volatility</option>
            <option value="stable">Stable Prices</option>
            <option value="increasing">Increasing Trend</option>
        </select>
    </div>
    
    <div id="predictions-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for pred in predictions %}
        <div class="p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-semibold text-gray-900">{{ pred.material }}</p>
                    <p class="text-sm text-gray-600 mt-1">Current: ${{ pred.current_price|floatformat:2 }}</p>
                    <p class="text-sm text-gray-600">Predicted: ${{ pred.predicted_price|floatformat:2 }}</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold 
                        {% if pred.change > 0 %}text-red-600{% elif pred.change < 0 %}text-green-600{% else %}text-gray-600{% endif %}">
                        {% if pred.change > 0 %}+{% endif %}{{ pred.change|floatformat:1 }}%
                    </div>
                    <div class="mt-1">
                        {% if pred.change > 5 %}
                            <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full">High Risk</span>
                        {% elif pred.change < -5 %}
                            <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">Opportunity</span>
                        {% else %}
                            <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">Stable</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="mt-3 flex gap-2">
                <button class="text-xs text-blue-600 hover:text-blue-700"
                        hx-get="/analytics/predictions/material/{{ pred.material_id }}/chart/"
                        hx-target="#modal-container">
                    View Chart
                </button>
                <button class="text-xs text-purple-600 hover:text-purple-700"
                        hx-get="/analytics/predictions/material/{{ pred.material_id }}/confidence/"
                        hx-target="#modal-container">
                    Confidence Interval
                </button>
                <button class="text-xs text-green-600 hover:text-green-700"
                        hx-post="/analytics/predictions/material/{{ pred.material_id }}/action/"
                        hx-target="#modal-container">
                    Take Action
                </button>
            </div>
        </div>
        {% empty %}
        <div class="col-span-2 text-center py-8 text-gray-500">
            <i class="fas fa-chart-line text-4xl mb-3"></i>
            <p>Insufficient data for predictions</p>
            <p class="text-sm mt-2">Continue uploading historical data to enable predictions</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Demand and What-If Analysis -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Demand Forecast -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-navy-900 mb-4">
            <i class="fas fa-box text-indigo-600 mr-2"></i>
            Demand Forecast
        </h3>
        <div class="h-64 mb-4">
            <canvas id="demandForecastChart"></canvas>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="p-2 bg-gray-50 rounded">
                <span class="text-gray-600">Accuracy:</span>
                <span class="font-semibold text-green-600 float-right">{{ prediction_metrics.model_accuracy|floatformat:1|default:"0" }}%</span>
            </div>
            <div class="p-2 bg-gray-50 rounded">
                <span class="text-gray-600">Last Updated:</span>
                <span class="font-semibold float-right">Just now</span>
            </div>
        </div>
    </div>
    
    <!-- What-If Scenario -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-navy-900 mb-4">
            <i class="fas fa-sliders-h text-teal-600 mr-2"></i>
            What-If Scenario Analysis
        </h3>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Price Change: <span id="priceIncreaseValue" class="font-bold">10%</span>
                </label>
                <input type="range" min="0" max="50" value="10" class="w-full" 
                       id="priceIncrease"
                       hx-post="/analytics/scenario/calculate/"
                       hx-trigger="change delay:500ms"
                       hx-target="#scenario-impact"
                       hx-include="#volumeChange">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Volume Change: <span id="volumeChangeValue" class="font-bold">0%</span>
                </label>
                <input type="range" min="-50" max="50" value="0" class="w-full" 
                       id="volumeChange"
                       hx-post="/analytics/scenario/calculate/"
                       hx-trigger="change delay:500ms"
                       hx-target="#scenario-impact"
                       hx-include="#priceIncrease">
            </div>
            
            <div id="scenario-impact" class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg">
                <p class="text-sm text-gray-600 mb-2">Projected Budget Impact:</p>
                <p class="text-3xl font-bold text-navy-900">${{ scenario_impact.total_impact|floatformat:0|default:"0" }}</p>
                <p class="text-xs text-gray-600 mt-2">Based on current monthly spend of ${{ scenario_impact.current_spend|floatformat:0|default:"0" }}</p>
            </div>
            
            <button class="w-full btn btn-outline btn-sm"
                    hx-get="/analytics/scenario/detailed/"
                    hx-target="#modal-container">
                View Detailed Analysis
            </button>
        </div>
    </div>
</div>

<!-- AI Recommendations -->
<div class="bg-white rounded-lg border border-gray-200 p-6">
    <h3 class="text-lg font-semibold text-navy-900 mb-4">
        <i class="fas fa-robot text-blue-600 mr-2"></i>
        AI-Powered Recommendations
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for rec in ai_recommendations %}
        <div class="p-4 bg-{{ rec.color }}-50 border-l-4 border-{{ rec.color }}-500 rounded">
            <div class="flex items-start">
                <i class="fas {{ rec.icon }} text-{{ rec.color }}-600 mr-3 mt-1"></i>
                <div>
                    <p class="font-medium text-gray-900">{{ rec.title }}</p>
                    <p class="text-sm text-gray-600 mt-1">{{ rec.description }}</p>
                    <a href="{{ rec.action_url }}" class="text-xs text-{{ rec.color }}-600 hover:text-{{ rec.color }}-700 mt-2 inline-block">
                        {{ rec.action }} →
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-span-3 text-center py-6 text-gray-500">
            <i class="fas fa-robot text-3xl mb-2"></i>
            <p>Analyzing data to generate recommendations...</p>
            <p class="text-sm mt-1">Add more data to enable AI insights</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Actions -->
<div class="mt-6 flex justify-center gap-3">
    <button class="btn btn-primary"
            hx-get="/analytics/export/predictions/">
        <i class="fas fa-download mr-2"></i>Export Predictions
    </button>
    <button class="btn btn-outline"
            hx-get="/analytics/predictions/settings/"
            hx-target="#modal-container">
        <i class="fas fa-cog mr-2"></i>Model Settings
    </button>
    <button class="btn btn-outline"
            hx-get="/analytics/predictions/retrain/"
            hx-target="#modal-container">
        <i class="fas fa-sync-alt mr-2"></i>Retrain Models
    </button>
</div>

<script>
// Update slider values
document.getElementById('priceIncrease').addEventListener('input', function(e) {
    document.getElementById('priceIncreaseValue').textContent = e.target.value + '%';
});

document.getElementById('volumeChange').addEventListener('input', function(e) {
    const value = e.target.value;
    document.getElementById('volumeChangeValue').textContent = (value > 0 ? '+' : '') + value + '%';
});

// Initialize prediction charts after HTMX loads
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(initializePredictionCharts, 100);
});
</script>